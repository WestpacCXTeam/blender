'use strict';

//--------------------------------------------------------------------------------------------------------------------------------------------------------------
//
//                                           ██████╗  ██╗   ██╗ ██╗     ██████╗  ██╗      ███████╗ ███╗   ██╗ ██████╗
//                                          ██╔════╝  ██║   ██║ ██║     ██╔══██╗ ██║      ██╔════╝ ████╗  ██║ ██╔══██╗
//                                          ██║  ███╗ ██║   ██║ ██║     ██████╔╝ ██║      █████╗   ██╔██╗ ██║ ██║  ██║
//                                          ██║   ██║ ██║   ██║ ██║     ██╔══██╗ ██║      ██╔══╝   ██║╚██╗██║ ██║  ██║
//                                          ╚██████╔╝ ╚██████╔╝ ██║     ██████╔╝ ███████╗ ███████╗ ██║ ╚████║ ██████╔╝
//                                           ╚═════╝   ╚═════╝  ╚═╝     ╚═════╝  ╚══════╝ ╚══════╝ ╚═╝  ╚═══╝ ╚═════╝
//                                                                       Created by Westpac Design Delivery Team
// @desc     GUI blend
// @author   Dominik Wilkowski
// @website  https://github.com/WestpacCXTeam/GUI-source
// @issues   https://github.com/WestpacCXTeam/GUI-source/issues
//--------------------------------------------------------------------------------------------------------------------------------------------------------------


//--------------------------------------------------------------------------------------------------------------------------------------------------------------
// External dependencies
//--------------------------------------------------------------------------------------------------------------------------------------------------------------


//--------------------------------------------------------------------------------------------------------------------------------------------------------------
// Custom functions
//--------------------------------------------------------------------------------------------------------------------------------------------------------------


//--------------------------------------------------------------------------------------------------------------------------------------------------------------
// Settings
//--------------------------------------------------------------------------------------------------------------------------------------------------------------
var SETTINGS = function() {
	return {
		'folder': {
			'js': 'source/js',
			'less': 'source/less',

			'prod': '.',
			'assets': 'assets',

			'PackageJSON': 'package.json',
		},
	};
};


//--------------------------------------------------------------------------------------------------------------------------------------------------------------
// Grunt module
//--------------------------------------------------------------------------------------------------------------------------------------------------------------
module.exports = function(grunt) {

	//------------------------------------------------------------------------------------------------------------------------------------------------------------
	// Dependencies
	//------------------------------------------------------------------------------------------------------------------------------------------------------------
	grunt.loadNpmTasks('grunt-contrib-connect');
	grunt.loadNpmTasks('grunt-contrib-concat');
	grunt.loadNpmTasks('grunt-contrib-uglify');
	grunt.loadNpmTasks('grunt-contrib-watch');
	grunt.loadNpmTasks('grunt-contrib-less');
	grunt.loadNpmTasks('grunt-wakeup');
	grunt.loadNpmTasks('grunt-font');


	//------------------------------------------------------------------------------------------------------------------------------------------------------------
	// Custom grunt tasks
	//------------------------------------------------------------------------------------------------------------------------------------------------------------


	//------------------------------------------------------------------------------------------------------------------------------------------------------------
	// Default grunt tasks
	//------------------------------------------------------------------------------------------------------------------------------------------------------------
	grunt.initConfig({


		//----------------------------------------------------------------------------------------------------------------------------------------------------------
		// Package content
		//----------------------------------------------------------------------------------------------------------------------------------------------------------
		SETTINGS: SETTINGS(),
		pkg: grunt.file.readJSON( SETTINGS().folder.PackageJSON ),


		//----------------------------------------------------------------------------------------------------------------------------------------------------------
		// Compile less to CSS
		//----------------------------------------------------------------------------------------------------------------------------------------------------------
		less: {
			GUI: {
				options: {
					cleancss: true,
					compress: true,
					ieCompat: true,
					report: 'min',
					plugins : [ new (require('less-plugin-autoprefix'))({ browsers: [ 'last 2 versions', 'ie 8', 'ie 9', 'ie 10' ] }) ],
				},
				files: {
					'<%= SETTINGS.folder.prod %>/<%= SETTINGS.folder.assets %>/css/gui.min.css': '<%= SETTINGS.folder.less %>/gui.less',
				},
			},
		},


		//----------------------------------------------------------------------------------------------------------------------------------------------------------
		// Minify js
		//----------------------------------------------------------------------------------------------------------------------------------------------------------
		uglify: {
			options: {
				mangle: false,
				report: 'gzip',
			},

			GUI: {
				files: {
					'<%= SETTINGS.folder.prod %>/<%= SETTINGS.folder.assets %>/js/gui.min.js': [
						'<%= SETTINGS.folder.js %>/*.js',
						'!<%= SETTINGS.folder.js %>/*jquery*.js',
					],
				},
			},
		},


		//----------------------------------------------------------------------------------------------------------------------------------------------------------
		// Concat js jquery files into the gui.min.js
		//----------------------------------------------------------------------------------------------------------------------------------------------------------
		concat: {
			GUI: {
				files: {
					'<%= SETTINGS.folder.prod %>/<%= SETTINGS.folder.assets %>/js/gui.min.js': [
						'<%= SETTINGS.folder.js %>/*jquery*.js',
						'<%= SETTINGS.folder.prod %>/<%= SETTINGS.folder.assets %>/js/gui.min.js',
					],
				},
			},
		},


		//----------------------------------------------------------------------------------------------------------------------------------------------------------
		// Banners
		//----------------------------------------------------------------------------------------------------------------------------------------------------------
		font: {
			options: {
				space: false,
				maxLength: 11,
				colors: ['white', 'gray'],
			},

			title: {
				text: '| GUI blend',
			},
		},


		//----------------------------------------------------------------------------------------------------------------------------------------------------------
		// Wakeup
		//----------------------------------------------------------------------------------------------------------------------------------------------------------
		wakeup: {
			wakeme: {
				options: {
					randomize: true,
					notifications: true,
				},
			},
		},


		//----------------------------------------------------------------------------------------------------------------------------------------------------------
		// Watch
		//----------------------------------------------------------------------------------------------------------------------------------------------------------
		watch: {
			js: {
				files: [
					'<%= SETTINGS.folder.js %>/**/*.js',
				],
				tasks: [
					'_js',
					'wakeup',
				],
			},

			less: {
				files: [
					'<%= SETTINGS.folder.less %>/**/*.less',
				],
				tasks: [
					'_less',
					'wakeup',
				],
			},
		},


		//----------------------------------------------------------------------------------------------------------------------------------------------------------
		// server
		//----------------------------------------------------------------------------------------------------------------------------------------------------------
		connect: {
			server: {
				options: {
					open: false,
					hostname: '127.0.0.1',
					port: 8888,
					directory: '<%= SETTINGS.folder.prod %>',
					base: '<%= SETTINGS.folder.prod %>',
				},
			},
		},

	});



	//------------------------------------------------------------------------------------------------------------------------------------------------------------
	// Private tasks
	//------------------------------------------------------------------------------------------------------------------------------------------------------------
	grunt.registerTask('_less', [
		'less',
	]);

	grunt.registerTask('_js', [
		'uglify',
		'concat',
	]);

	grunt.registerTask('_build', [
		'font',
		'_less',
		'_js',
	]);


	//------------------------------------------------------------------------------------------------------------------------------------------------------------
	// Build tasks
	//------------------------------------------------------------------------------------------------------------------------------------------------------------
	grunt.registerTask('default', [ //run build with watch
		'_build',
		'connect',
		'watch',
	]);

	grunt.registerTask('build', [ //just build
		'_build',
		'wakeup',
	]);

	grunt.registerTask('server', [ //just start server and watch
		'connect',
		'watch',
		'wakeup',
	]);

};